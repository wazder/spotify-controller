<!-- File: index.html -->
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
  <title>Wazder Spotify Player</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #000;
      color: #fff;
      position: relative;
    }
    #containers {
      display: flex;
      gap: 20px;
    }
    #playlistContainer, #trackContainer {
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background-color: #111;
      padding: 10px;
      border-radius: 4px;
    }
    .playlist-item, .track-item {
      width: 100%;
      box-sizing: border-box;
      padding: 10px;
      margin-bottom: 5px;
      border: 2px solid #333;
      border-radius: 4px;
      position: relative;
      cursor: pointer;
      overflow: hidden;
    }
    .playlist-item span, .track-item span {
      display: inline-block;
      white-space: nowrap;
    }
    /* √áalan playlist */
    .playlist-item.playing-playlist { border-color: #1DB954; }
    .playlist-item.playing-playlist::after { content: " üîä"; right: 10px; top: 50%; transform: translateY(-50%); }
    /* Se√ßili playlist */
    .playlist-item.selected-playlist { border-color: brown; }
    .playlist-item.selected-playlist::after { content: " üìÇ"; right: 10px; top: 50%; transform: translateY(-50%); }
    /* Hem √ßalƒ±yor hem se√ßili */
    .playlist-item.playing-playlist.selected-playlist {
      background-color: #1DB954;
      color: #000;
      border-color: #1DB954;
    }
    .playlist-item.playing-playlist.selected-playlist::after { content: " üîäüìÇ"; right: 10px; top: 50%; transform: translateY(-50%); }

    /* √áalan track */
    .track-item.playing-track { background-color: #1DB954; color: #000; }
    .track-item.playing-track::after { content: " ‚ñ∂Ô∏è"; right: 10px; top: 50%; transform: translateY(-50%); }

    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background-color: #1DB954;
      color: #fff;
      cursor: pointer;
    }
    #prevButton, #nextButton {
      position: absolute;
      top: 20px;
    }
    #prevButton { right: 120px; }
    #nextButton { right: 20px; }

    @keyframes marquee {
      0%   { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }
    .playlist-item:hover span,
    .track-item:hover span,
    .playlist-item.playing-playlist span,
    .track-item.playing-track span {
      animation: marquee 5s linear infinite;
    }
  </style>
</head>
<body>
  <button id="loginBtn">Spotify Login</button>

  <div id="app" style="display:none;">
    <h2>Playliste Connection works</h2>
    <div id="containers">
      <div>
        <h3>Playlists</h3>
        <div id="playlistContainer"></div>
      </div>
      <div>
        <h3>Tracks</h3>
        <div id="trackContainer"></div>
      </div>
    </div>
    <button id="prevButton">Previous</button>
    <button id="nextButton">Next</button>
  </div>

  <script>
    // Global state
    let playlists = [], currentTracks = [];
    let selectedPlaylistId = '', playingPlaylistId = '';
    let currentTrackUri = '', currentIndex = 0;

    // PKCE helpers
    function generateRandomString(len) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < len; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }
    async function sha256(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);
      const hash = await crypto.subtle.digest('SHA-256', data);
      const bytes = new Uint8Array(hash);
      let binary = '';
      for (let b of bytes) binary += String.fromCharCode(b);
      return btoa(binary).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }
